<div class="title">
  <h2>Publicaciones</h2>
</div>

<div class="card">
  <!-- Formulario para crear una publicación -->
  <div class="nuevo">
    <form [formGroup]="publicationForm" (ngSubmit)="onCreatePublication()">
      <div>
        <input
          class="input"
          id="title"
          formControlName="title"
          type="text"
          placeholder="Título"
        />
        <div
          *ngIf="publicationForm.controls['title'].invalid && publicationForm.controls['title'].touched"
        >
          <small class="error">Este campo es obligatorio.</small>
        </div>
      </div>

      <div>
        <textarea
          class="textarea"
          id="content"
          formControlName="content"
          placeholder="Contenido"
        ></textarea>
        <div
          *ngIf="publicationForm.controls['content'].invalid && publicationForm.controls['content'].touched"
        >
          <small class="error">Este campo es obligatorio.</small>
        </div>
      </div>

      <div>
        <input
          class="file-input"
          id="file"
          type="file"
          (change)="onFileSelected($event)"
        />
        <div
          *ngIf="publicationForm.controls['file'].invalid && publicationForm.controls['file'].touched"
        >
          <small class="error">El archivo es obligatorio.</small>
        </div>
      </div>

      <button class="submit-button" type="submit" [disabled]="publicationForm.invalid">
        Crear publicación
      </button>
    </form>
  </div>
</div>

<!-- Listado de publicaciones -->
<div *ngIf="publications.length > 0; else noPublications">
  <div *ngFor="let publication of publications" class="publicacion">
    <div class="cabeza">
      <div class="principal">
        <img class="logo" src="assets/logo.png" alt="Logo" />
        <span class="usuario">{{ publication.user?.username }}</span>
      </div>
      <div class="eliminar">
        <span>{{ publication.date }}</span>
        <button (click)="onDeletePublication(publication.id)">
          Eliminar
        </button>
      </div>
    </div>

    <div class="contenido">
      <h3>{{ publication.title }}</h3>
      <p>{{ publication.content }}</p>
      <div *ngIf="publication.file">
        <img *ngIf="publication.fileType === 'image'" class="media-image" [src]="publication.file" />
        <video *ngIf="publication.fileType === 'video'" class="media-video" controls>
          <source [src]="publication.file" />
        </video>
      </div>
    </div>
  </div>
</div>

<ng-template #noPublications>
  <p>No hay publicaciones disponibles.</p>
</ng-template>
